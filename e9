#!/bin/bash

stc () { local e;e=$(speedtest --simple 2>/dev/null|grep -Ei 'Ping|Download|Upload');[[ "$e" ]] || return;echo $(date +"%Y-%m-%d %H:%M:%S") $e; }

if [[ $1 ]];then
    stc
else
    mc=$(date +%M);nr=$(date +%s%N);mr=$(awk -v m=0 -v x=59 -v s="$nr" "BEGIN{srand(s);print int(m+rand()*(x-m+1))}")
    if [[ "$mc" -eq "$mr" ]];then stc >> e9.log 2>/dev/null;fi
fi

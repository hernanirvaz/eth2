#!/usr/bin/bash

source /home/eth/eth2/a2

if [[ $cunm = hrv-zotac2 ]];then
  mt1 () { id jellyfin &>>/dev/null; }
  mt2 () { id plex     &>>/dev/null; }
  mdi () { if mt2;then echo /var/lib/plexmediaserver/mp4;else echo /media/mp4;fi; }
  mus () { if mt2;then echo plex                        ;else echo eth       ;fi; }
  rsy () { echo -e "\n\nrsync $1 $2";rsync --ignore-existing --delete --numeric-ids -rv -e "ssh -p $3 -i ~/.ssh/id_ed25519" $1 $2; }
  smv () { local s=hrv-zotac3;local p=$(dnz $s);local d=$(mdi);rsy $d/movie  $(dnn $s): $p;rsy $d/tv  $(dnn $s): $p; }
  stv () { local s=hrv-zotac1;local p=$(dnz $s);local d=$(mdi);rsy $d/tv2    $(dnn $s): $p; }
  slt () { local s=hrv-zotac3;local p=$(dnz $s);local d=$(mdi);rsy $d/lust   $(dnn $s): $p; }
  sal () { smv;sleep 10;stv;sleep 10;slt; }
  pmv () { local s=hrv-zotac3;local p=$(dnz $s);rsy $(dnn $s):~/movie /media/mp4 $p;rsy $(dnn $s):~/tv /media/mp4 $p; }
  ptv () { local s=hrv-zotac1;local p=$(dnz $s);rsy $(dnn $s):~/tv2   /media/mp4 $p; }
  plt () { local s=hrv-zotac3;local p=$(dnz $s);rsy $(dnn $s):~/lust  /media/mp4 $p; }
  pal () { pmv;ptv;plt; }
  fi0 () { local d=$(mdi);echo findls $1 $d;find $d -name "*.$1" -print; }
  fi1 () { local d=$(mdi);echo findrm $1 $d;find $d -name "*.$1" -exec sudo rm {} \;; }
  fll () { if [[ $1 ]];then fi0 $1;else fi0 txt;fi0 jpg;fi; }
  frm () { if [[ $1 ]];then fi1 $1;else fi1 txt;fi1 jpg;fi; }
  fom () { local d=$(mdi);echo "ch[own|mod] $meui:$megi $d";sudo chown $meui:$megi -R $d;sudo find $d -type d -exec chmod 755 {} \;;sudo find $d -type f -exec chmod 644 {} \;; }
  ft1 () { local d=${1:-$(mdi)/lust/ftv};find $d \( -iname "*.mp4" -or -iname "*.mkv" -or -iname "*.avi" \) -printf "%f\n"|grep -Po '\.[0-9]{2}\.\K[a-zA-Z]+'           |sort -u; }
  ft2 () { local d=${1:-$(mdi)/lust/ftv};find $d \( -iname "*.mp4" -or -iname "*.mkv" -or -iname "*.avi" \) -printf "%f\n"|grep -Po '\.[0-9]{2}\.\K[a-zA-Z]+\.[a-zA-Z]+'|sort -u; }
  fmv () { local d=${1:-$(mdi)/lust/ftv};find $d \( -iname "*.mp4" -or -iname "*.mkv" -or -iname "*.avi" \) -printf "%f\n"|sed -En "s%^(ftv.+)(\.[0-9]{2}\.[0-9]{2}\.[0-9]{2}\.)([a-z]+\.)([a-z]+\.)([a-z]+)(.*)([a-z0-9]{3})$%mv $d/\1\2\3\4\5\6\7 $d/\3\4\5\2\7%ip"; }
  ufz () { echo "$B"|gpg --batch --yes --pinentry-mode loopback --passphrase-fd 0 -c $1; }
  zfu () { echo "$B"|gpg --batch --yes --pinentry-mode loopback --passphrase-fd 0 -d $1; }
  hlp () {
    cat <<'EOF'
{ps}{mv|tv|lt|al}       pull|sync movie|tv|lt|all
f{ll|rm|om}             list|remove|permission files
r{ll|cd|pr|ar}          list|dir|para|arranca transmissions
m{cd|up|dw|rs|st|ud|lg} media dir|up|down|restart|status|update|logs
f[tm][12v]              ftv names first|second|mv command
{ufz|zfu} file          encrypt|decrypt file
EOF
  }
  alias rcd="cd $trdi;pwd;hlp"
  alias rpr='cd ~/media-stack && docker compose stop  transmission;t6 rco'
  alias rar='cd ~/media-stack && docker compose start transmission;t6 rop'
  alias rll='docker exec transmission transmission-remote -l'
  alias mcd="cd $mddi;pwd;du -hs \$(ls)|sort -h"
  alias mup='cd ~/media-stack && docker compose up -d'
  alias mdw='cd ~/media-stack && docker compose down'
  alias mrs='cd ~/media-stack && docker compose restart'
  alias mst='cd ~/media-stack && docker compose ps'
  alias mud='cd ~/media-stack && docker compose pull && docker compose up -d'
  alias mlg='cd ~/media-stack && docker compose logs -f'
  alias ct='tail -n10 cns.log'
  alias ce='cns ceth;tail -n10 cns.log'
elif [[ $cunm = hrv-intel5 || $cunm = hrv-intel6 ]];then
  alias aa='t6 ah'
elif [[ $cunm = hrv-zotac3 || $cunm = hrv-zotac4 ]];then
  alias aa='t6 ch'
fi

if sht;then
  alias mr='echo meo:$V ;telnet 192.168.8.1'
else
  alias aa='t6 ah'
fi

alias st='e9 force'
alias hh='t6 hs0'
alias tt='t6 hsh'

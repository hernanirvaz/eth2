#!/usr/bin/bash

pfpd='2001:8a0:fcdc:3600'
cunm=$(hostname)
cuip=$(hostname -I);cuip=${cuip%% *}
trdi='/mnt/data/downloads'
mddi='/media/mp4'

function sin {
  case $1 in
  hrv-zotac1*) printf 192.168.8.25 ;;
  hrv-zotac2*) printf 192.168.8.28 ;;
  hrv-zotac3*) printf 192.168.8.31 ;;
  hrv-zotac4*) printf 192.168.8.34 ;;
  hrv-intel5*) printf 192.168.8.37 ;;
  hrv-intel6*) printf 192.168.8.40 ;;
  hrv-zen*   ) printf 192.168.8.100 ;;
  hrv-lenovo*) printf 192.168.8.101 ;;
  *) printf %s "$1" ;;
  esac
}
function si6 {
  case $1 in
  hrv-zotac1*) printf %s $pfpd:201:2eff:fea0:88d4 ;;
  hrv-zotac2*) printf %s $pfpd::1002 ;;
  hrv-zotac3*) printf %s $pfpd::1003 ;;
  hrv-zotac4*) printf %s $pfpd::1004 ;;
  hrv-intel5*) printf %s $pfpd::1005 ;;
  hrv-intel6*) printf %s $pfpd::1006 ;;
  hrv-zen*   ) printf %s $pfpd::1100 ;;
  hrv-lenovo*) printf %s $pfpd::1101 ;;
  *) printf %s "$1" ;;
  esac
}
function sl6 {
  case $1 in
  hrv-zotac1*) printf %s fe80::201:2eff:fea0:88d4 ;;
  hrv-zotac2*) printf %s fe80::201:2eff:fea0:e06f ;;
  hrv-zotac3*) printf %s fe80::201:2eff:fea0:88ea ;;
  hrv-zotac4*) printf %s fe80::201:2eff:fea4:f04c ;;
  hrv-intel5*) printf %s fe80::4a21:bff:fe55:4076 ;;
  hrv-intel6*) printf %s fe80::4a21:bff:fe52:6c5e ;;
  hrv-zen*   ) printf %s fe80::9fa6:2019:3db8:d1b6 ;;
  hrv-lenovo*) printf %s fe80::c988:b438:1645:2e90 ;;
  *) printf %s "$1" ;;
  esac
}
function spn {
  local n=2020
  local s=${1%%.*}
  case $1 in
  hrv*) n=$((n+${s##*[!0-9]})) ;;
  192.168.8.25) n=2021 ;;
  192.168.8.28) n=2022 ;;
  192.168.8.31) n=2023 ;;
  192.168.8.34) n=2024 ;;
  192.168.8.37) n=2025 ;;
  192.168.8.40) n=2026 ;;
  esac
  printf %i $n
}
function sht { [[ ${1:-$cuip} = 192.168.8.* ]]; }
function snt { [[ $1 = hrv* ]]; }
function smt { sht "$1" || snt "$1"; }
function sst { local s=${1:-$cunm};[[ $s != hrv-zen && $s != hrv-lenovo ]]; }
function dnn { local s=$1;snt "$s" && ! sht && s="$s.fruga.pt";nslookup "$s" 2>/dev/null 1>&2 || s=$(sin "$1");[[ "$s" = 192.168.8.25 || "$s" = hrv-zotac1* ]] && s="admin@$s";printf %s "$s"; }
function dnz { local p=$2;[[ $p ]] || p=$(spn "$1");printf %i "$p"; }
function zsh { ssh -4p "$1" -i ~/.ssh/id_ed25519 "$2" "$3"; }
function zcp { local p=$1;local d=$2;shift;shift;scp -4rP "$p" -i ~/.ssh/id_ed25519 $@ "$d"; }
function pcm { 
  local n;local p;local e=${1^^};local s=hrv-zotac1;n=$(dnn $s);p=$(dnz $s)
  if [[ $e = PRB ]];then 
    zsh "$p" "$n" "/etc/rc.reboot"
  elif [[ $e = NTP ]];then 
    zsh "$p" "$n" "ntpq -np"
  elif [[ $e = LRB ]];then
    zsh "$p" "$n" "echo df;df -h /;echo;echo last reboot;last reboot|head -n5|sed 's%  *% %g'|sort -n;echo;echo wan check log;tail -n5 /root/rt-pfsense-wan-check.log;echo;date +'%Y-%m-%d %H:%M:%S'"
  else 
    zsh "$p" "$n" 'cat /root/rt-pfsense-wan-check.log'
  fi
}
function tcm {
  local s
  s=hrv-zotac1;echo -e "\n\e[32m$s pfSense\e[0m";pcm NTP
  s=hrv-zotac2;echo -e "\n\e[32m$s chronyc\e[0m";zsh $(dnz $s) $(dnn $s) "chronyc -n sources"
}
function slk { local s=${1:-UP};ip -j link|jq -r ".[]|select(.operstate==\"${s^^}\").ifname"|grep -E '^(en|wl)'; }
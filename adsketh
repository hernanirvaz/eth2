#!/usr/bin/bash

source /home/eth/eth2/a2

function cz1 { zcp $2 $(dnn $1):~/.bash_aliases ~/eth2/asrv; }
function cz2 { zcp $2 $(dnn $1):~/eth2 ~/eth2/t[1-9] ~/eth2/e? ~/eth2/a?; }
function nrs { sudo netplan apply;sudo systemctl stop systemd-resolved;sleep 9;sudo systemctl start systemd-resolved;sleep 9;resolvectl status; }
function ecp { local p=$(dnz $1 $2);local s=$(dnn $1);echo "scp -4rP $p \$@ $s:~/eth2";cz2 $1 $p; }
function ocp { local p=$(dnz $1 $2);local s=$(dnn $1);echo "scp -4rP $p \$@ $s:"      ;cz1 $1 $p;zcp $p $s:~/.ssh/authorized_keys ~/eth2/keth; }
function ccp { local p=$(dnz $1 $2);local s=$(dnn $1);echo "scp -4rP $p \$@ $s:"      ;zcp $p $s: ~/eth2/cns.keys.gpg ~/eth2/hernanirvaz-f2e8fb66dbc0.json.gpg; }
function rcp { local p=$(dnz $1 $2);local s=$(dnn $1);echo "scp -4rP $p \$@ $s:"      ;zcp $p $s:/root/.ssh/authorized_keys ~/eth2/keth;zcp $p $s:/root ~/eth2/rt-pfsense-wan-check.sh; }
function ecv { local s='';for s in $@;do ecp $s;done; }
function ocv { local s='';for s in $@;do ocp $s;done; }
function ei0 { echo -e "export H=\"$1\"\nexport E=\"$2\"\nexport R=\"$3\"\nexport V=\"$4\"\npr=$5"; }
function ei1 { echo -e "echo>>~/.bashrc\necho \"export PATH=\\\"\\\$PATH:/home/eth/eth2\\\"\">>~/.bashrc\necho \"export H=\\\"$1\\\"\">>~/.bashrc\necho \"export V=\\\"$2\\\"\">>~/.bashrc\necho \"export K=\\\"$3\\\"\">>~/.bashrc\necho \"export E=\\\"$4\\\"\">>~/.bashrc\necho \"export B=\\\"$5\\\"\">>~/.bashrc\necho \"PS1=\\\"\\\$H:\\\h: \\\"\">>~/.bashrc\nchmod 755 ~/eth2/t[1-9] ~/eth2/e?"; }
function cz0 {
  if smt $1;then local u=eu;else local u=ubuntu;fi;local s="$u@$1"
  scp -P 22 ~/eth2/s? ~/eth2/keth ~/i0 $s:~
  echo -e "\n\n\n\nsudo -i\nbash /home/$u/s0\n\n\n\n"
  ssh -p 22 $s
  cz1 $1 $2
  cz2 $1 $2
  zcp $2 $1: ~/i1
  zsh $2 $1 'sh i1'
  echo -e "\n\nky # gerar key & copiar para keth\nt2 # setup\n\n"
  zsh $2 $1
}
function nfc {
  local d='/mnt/mp4'
  if ! systemctl is-active --quiet nfs-client.target;then
    sudo apt update                &>> nfc.out
    sudo apt install nfs-common -y &>> nfc.out
  fi
  [[ -d $d        ]] || sudo mkdir -p $d
  [[ -d $d/movie/ ]] || sudo mount 192.168.8.28:$1 $d
  ll $d
}
function nfj { nfc '/media/mp4'; }
function nfp { nfc '/var/lib/plexmediaserver/mp4'; }
function z7z {
  local a=${1:-1}
  local u=$(whoami)
  local f="/home/$u/cs$a.7z"
  local d="/media/$u/cs$a"
  [[ -d $d ]] || return
  sudo 7z a -p$W -mhe=on "$f" "$d"
  sudo chown "$u:$u" "$f"
}
function ufz { echo "$B"|gpg --batch --yes --pinentry-mode loopback --passphrase-fd 0 -c "$1"; }
function zfu { echo "$B"|gpg --batch --yes --pinentry-mode loopback --passphrase-fd 0 -d "$1"; }
function rcz {
  local u='/conf/config.xml'
  if [[ -s $1 ]];then 
    ufz "$1";mv "$1.gpg" ~/eth2/"$3"  ;echo Found $(basename "$1")
    if [[ -d $4 ]];then cp "$1" "$4$u";echo Found "$4$u";fi
    rm "$1"
  else
    echo Not found $(basename "$2")
  fi
} 
function rcf { 
  local f;local s
  s='Downloads/config-hrv-zotac1.home.arpa';f=$(find ~/$s*.xml 2>/dev/null|sort -t. -k3n|tail -n1);rcz "$f" "$s" rt-pfsense.xml.gpg /media/eth/PFSENSE
  s='Downloads/ArcherC6v220220613137n'     ;f=$(find ~/$s*.bin 2>/dev/null|tail -n1)              ;rcz "$f" "$s" rt-tplink.bin.gpg
  s='rt-pfsense'                           ;f=$(find ~/$s*.txt 2>/dev/null|tail -n1)              ;rcz "$f" "$s"
}
function vls {
  [[ $# -eq 0 ]] && return;local s='';local c=1;local p=2020 
  for s in $@;do 
    alias v$c="esl $s $p"
    alias pv$c="ping $s"
    alias kv$c="ei0 \$H \$E \$R \$V $p >~/i0;ei1 \$H \$V \$K \$E \$B >~/i1;cz0 $s $p"
    ((c++))
  done
  alias vp="ecv $@"
  alias vo="ocv $@"
}
function zls {
  [[ $# -eq 0 ]] && return;local s='';local c=2;local p=2020 
  for s in $@;do 
    p=$(spn $s)
    alias pz$c="ping $(sin $s)"
    alias kz$c="ei0 \$H \$E \$R \$V $p >~/i0;ei1 \$H \$V \$K \$E \$B >~/i1;cz0 $(sin $s) $p"
    ((c++))
  done
}

zls hrv-zotac2 hrv-zotac3 hrv-zotac4 hrv-intel5 hrv-intel6
vls ns31198432.ip-51-89-64.eu

alias wgp='sudo wg-quick down wg0'
alias wga='sudo wg-quick up   wg0'
# alias wge='sudo systemctl enable  wg-quick@wg0'
# alias wgd='sudo systemctl disable wg-quick@wg0'
alias wgs='sudo wg show'

alias mr='echo 192.168.1.254:$V ;telnet 192.168.1.254'
alias zp="ecv hrv-intel6 hrv-intel5 hrv-zotac4 hrv-zotac3 hrv-zotac2"
alias zo="ocv hrv-intel6 hrv-intel5 hrv-zotac4 hrv-zotac3 hrv-zotac2;rcp hrv-zotac1"
alias zk="ccp hrv-zotac2"

alias gp='cd ~/eth2;git pull;cd'
alias gc='cd ~/eth2;git commit -am "cleanup";git push;cd'
alias gd='cd ~/eth2;git diff'
alias gt='cd ~/eth2;git status'
alias gr='rcf'

alias fw='echo "export R=\"$(</dev/urandom tr -dc "A-Za-z0-9?%&_+=@~#\,.?/"|head -c50)\"";echo "export H=\"$(</dev/urandom tr -dc "A-Za-z0-9?%&_+=@~#\,.?/"|head -c30)\"";echo "export V=\"$(</dev/urandom tr -dc "A-Za-z0-9"|head -c8)\"";echo "export K=\"$(</dev/urandom tr -dc "A-Za-z0-9?%&_+=@~#\,.?/"|head -c60)\"";echo "export W=\"$(</dev/urandom tr -dc "A-Za-z0-9?%&_+=@~#\,.?/"|head -c60)\"";'

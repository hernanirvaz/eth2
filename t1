#!/bin/bash

# utilities for commands/journal
function cex { echo -e "${i}${1^^}${f}";echo $H|sudo -S $1 2>$s3; }                                                                                           # superuser-command (visible)
function sex {                          echo $H|sudo -S $1 &>$s3; }                                                                                           # superuser-command (silent)
function sst { $w1 $1 2>$s3|grep "${2:-inactive\|failed}"                                   ; }                                                               # service status word test
function sse { $w1 $1 2>$s3|grep "${2:-Active:}"|sed "s%.*${2:-Active:} *\(${3:-.}*\).*%\1%"; }                                                               # service status word with data extraction
function sso { dts;echo "$1 $(printf '%6s' $(sse $2 Memory:)) $dt status: $(sse $2)"        ; }                                                               # service status output

i="\n\e[5m"
f="\e[25m\n"

s0='/usr/local/bin'
s1='/var/log/syslog'
s2='/etc/prometheus'
s3='/dev/null'
s4='/etc/systemd/system'
s5='/var/run/reboot-required'
p0='/home/eth'
p1='/var/lib/lighthouse'
p5="$p0/geth.log"
p2="$p0/beacon.log"
p3="$p0/bmedias.log"
p6="$p0/barqivo.log"
p4="$p0/beacon.restart"
p7="$p1/beacon"
p8="$p1/validators"

w0='systemctl'
w1="$w0 status"
w2="$w0 stop"
w3="$w0 start"
w4="$w0 enable"
w5="$w0 disable"
n0='eth-geth'
n1='eth-beacon'
n3='eth-validator'
n4='prometheus'
n5='prometheus-node-exporter'
n6='grafana-server'
o0='plexmediaserver'
o1='transmission-daemon'
o2='named'
o3='geth\[\|lighthouse'

meeu="$(whoami)"
cunm="$(uname -n)"
cust="$(uname -n|cut -c1-3)"
zip1='192.168.8.25'
zip2='192.168.8.28'
zip3='192.168.8.31'
znm1='hrv-zotac1'
znm2='hrv-zotac2'
znm3='hrv-zotac3'
vip1='207.180.214.8'
vip2='173.249.42.190'
vip3='164.68.107.45'
vnm1='vmi471826.contaboserver.net'
vnm2='vmi506976.contaboserver.net'
vnm3='vmi469069.contaboserver.net'
bpid=$(sse $n1 PID: [0-9])

rblk=22238623
ratt=00019000
pmis=00010000
pmat=00018800
pmah=00004500
pdly=00000500
decp=1000000000
hors=24
rate=4000
bpri=20                                                                                                                                                       # min    configured peers
bprs=10                                                                                                                                                       # step   configured peers
bprf=80                                                                                                                                                       # max    configured peers
bcpw=0                                                                                                                                                        # change configured peers weekday

if [[ $cust = hrv ]];then cgth=$zip1;else cgth=$vip1;fi
[[ $rate -eq 0 ]] && rate=$(curl -sX GET 'https://pro-api.coinmarketcap.com/v1/cryptocurrency/quotes/latest?symbol=ETH&convert=EUR&CMC_PRO_API_KEY=3ae5f3df-bd71-489d-a9dd-b626995fba31'|sed 's%.*price.:\([0-9]*\.[0-9]*\).*%\1%')

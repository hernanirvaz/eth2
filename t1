#!/bin/bash

source /home/eth/eth2/a1

cunm=$(hostname)
meeu=$(whoami)

znm1='hrv-zotac1';zip1=$(sin $znm1)
znm2='hrv-zotac2';zip2=$(sin $znm2)
znm3='hrv-zotac3';zip3=$(sin $znm3)
znm4='hrv-zotac4';zip4=$(sin $znm4)
inm5='hrv-intel5';iip5=$(sin $inm5)
inm6='hrv-intel6';iip6=$(sin $inm6)
pnm1='hrv-zen'   ;pip1=$(sin $pnm1)
pnm2='hrv-lenovo';pip2=$(sin $pnm2)
vip1='51.161.15.34' ;vnd1='ns570623.ip-51-161-15.net'
vip2='57.129.28.225';vnd2='ns3053175.ip-57-129-28.eu'
vip3='161.97.85.32' ;vnd3='vmi1007895.contaboserver.net'
vnm1=${vnd1%%.*};vis1='127.0.0.1'
vnm2=${vnd2%%.*};vis2='127.0.0.1'
vnm3=${vnd3%%.*};vis3='127.0.0.1'

if sht;then
cuvc=$znm4
nxvc=$znm4
cun1=$inm6
cun2=$inm5
cumv=$znm3
cut1=$znm2
cut2=$znm2
else
cuvc=$vnm1
nxvc=$vnm4
cun1=$vnm1
cun2=$vnm1
cumv=$vnm1
cut1=$vnm1
cut2=$vnm1
fi

p00='/usr/local/bin'
p01='/var/log/syslog'
p02='/home/eth'
p03='/dev/null'
p04='/etc/systemd/system'
p05='/var/lib/lighthouse'  ;[[ $cunm = $inm5 || $cunm = $inm6 ]] && p05='/cl/lighthouse'
p06=$p02
p07='/var/lib/nethermind'  ;[[ $cunm = $inm5 || $cunm = $inm6 ]] && p07='/el/nethermind'
p08='/var/lib/goethereum'  ;[[ $cunm = $vnm1 || $cunm = $vnm2 ]] && p08='/el/goethereum'
p09='/var/lib/javaethereum';[[ $cunm = $vnm1 || $cunm = $vnm2 ]] && p09='/el/javaethereum'
p10="$p02/geth.log"
p11="$p02/besu.log"
p12="$p02/beacon.log"
p13="$p02/bmedias.log"
p14=
p15=
p16="$p05/beacon"
p17="$p05/validators"
p18="$p17/slashing_protection.sqlite"
p19="$p02/validator_keys"
p20="$(dirname $p04)/timesyncd.conf"
p21='/etc/default/motd-news'
p22='/etc/netplan/00-installer-config.yaml'
p23='/etc/apt/apt.conf.d/50unattended-upgrades'
p24='/etc/update-motd.d/00-header'
p25='/etc/update-motd.d/10-help-text'
p26='/etc/grub.d/00_header'
p27='/etc/logrotate.d/rsyslog'
p28='/etc/update-motd.d/97-overlayroot'
p29='/etc/bind/named.conf.options'
p30='/etc/default/named'
p31='/etc/ntpsec/ntp.conf'
p32='/etc/nginx/conf.d/plexmediaserver.conf'
p33='/etc/transmission-daemon/settings.json'
p34='/usr/lib/systemd/system/transmission-daemon.service'
p35="$p02/pf.rs"
p36='/etc/environment'
p37='/etc/fstab'
p38='/etc/prometheus'
p39="$p02/sys.rs"
p40="$p02/geth.rs"
p41="$p02/besu.rs"
p42="$p02/bn.rs"
p43='/sys/devices/system/cpu/intel_pstate/no_turbo'
p44='/sys/bus/usb/devices/1-0:1.0/authorized'
p45='/var/run/reboot-required'
p46="$p02/vc.rs"
p47='/etc/apt/preferences.d'
p48='/etc/default/grub'
p49="$p02/validator.log"
p50="$p02/restart"
p51='/etc/apt/apt.conf.d/20auto-upgrades'
p52="$p02/mev.log"
p53="export H=$H;$p02/eth2/t6"
p54="$p02/eth2/t5"
p55="/etc/nut/ups.conf"
p56="/etc/nut/upsmon.conf"
p57="/etc/nut/upsd.conf"
p58='/var/lib/jwtethereum'
p59='/var/lib/transmission-daemon/downloads'
p60="/var/lib/plexmediaserver/mp4"
p61="$p02/delete"
p62="$p02/nethermind.log"
p63="$p02/neth.rs"
p64="$p02/dns.log"
p65='/etc/ssh/sshd_config.d/50-cloud-init.conf'
p66='/dev/nvme[0-9]n1'
p67='/etc/hosts'
p68='/etc/chrony/chrony.conf'
p69='/var/log/unattended-upgrades/unattended-upgrades-dpkg.log'
p70='/etc/profile.d/rvm.sh'
p71="$p02/.bashrc"
p72='cns.keys'
p73='hernanirvaz-f2e8fb66dbc0.json'
p74='/etc/exports'
p75='/etc/nfs.conf'
p76='/etc/samba/smb.conf'
p77='/etc/os-release'
p78='/etc/apt/trusted.gpg.d/jellyfin.gpg'
p79='/etc/apt/sources.list.d/jellyfin.list'
p80="/media/mp4"
p81='/etc/needrestart/needrestart.conf'
p82="$p02/eth2/e0"
p89='/proc/mdstat'

g00='(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) +'
g01='[0-9]{1,2} +'
g02='[0-9]{4}-[0-9]{2}-[0-9]{2}T'
g03='[0-9]{2}:[0-9]{2}:[0-9]{2}'
g04='\.[0-9]{1,3}'
g05='\[[0-9]*([0-9]{3})\] *:'
g06='geth\['
g07='besu\[.*\|'
g08='lighthouse\['
g09='mev-boost\['
g10='nethermind\['
g11="($g06|$g07|$g10)"
g12="($g06|$g07|$g10).*(Imported|Processed)"
g13="($g06|$g07|$g10|$g08|$g09)"
g14="($g06|$g07|$g08|$g09)"
g15='score:'
g16='DEBU?G +Measured BN latency'
g17='DEBU?G +Computed attestation selection proofs'
g18='DEBU?G +Delayed head block'
g19='DEBU?G +Processed HTTP API request'
g20="DEBU?G +Peer.*$g15 +[+-]?([0-9]|[0-9][0-9]|100)\."
g21='Block arrived early'
g22='Beacon chain re-org'
g23="$(date +%F) +"
g24='[-\+][0-9]{2}:[0-9]{2}'
g25='[ =\|]INFO[ \|]'
g26="$g25| DEBU?G "
g27='\sINFO\s'
g28='success'
g29='error'
g30='[Pp]eers'
g31='[Pp]eers'
g32='time_taken_ms:'
g33='latency:'
g34='duration='
g35='peercount='
g36="^$g23$g03$g04[0-9]*\|[A-Z]{4,}\|"
g37="$g36.*Processed"
g38='0 +new.+0 +unknown'
g39='request was cancelled|error making request to relay|Invalid execution payload'
g40="error calling registerValidator on relay"
g41="($g00$g01|$g02)"
g42="$g14.*(Prepared|payload|blinded|profitable|Block (from|is|was|broadcast)|(Valid|[Ss]igned|producing) block|published ?a? ?block|getHeader|submitBlindedBlock)"
g43="$g36.*(Produced block)"
g44="$g06.*Chain head was updated"
g45="$g08.*Previous epoch attestation.s"
g46="$g25|$g21|$g22"
g47="$g46|$g40"
g48="$g09.*$g40"
g49="$g08.*$g22"
g50="$g08.*$g31"
g51="$g09.*$g34"
g52='.+er: +([0-9]+) +([0-9]+) +([0-9]+) +([0-9]+).+'
g53='Block from monitored validator'
g54='imported_time_ms:'
g55='execution_time_ms:'
g56='attestable_delay_ms:'
g57="($g06|$g08).*ip[:=] +[0-9]"
g58="($g02)($g03)(\.[0-9]{3})[0-9]*$g24"
g59='Restarting services'
g60='Log +started: +'
g61='Log +ended: +'
g62='Service restarts being deferred'
g63='Reference|Stratum|Root|Leap|time|ppm'
g64='reorg_distance:'
g65='^\^,[\*\+],[^,]+'
g66='[^,]+,[0-3][1357]7' # Reach of last 8 polls NTP requests binary ?? ??1 111
g67="^$g23$g03$g04[0-9]*\|INFO\|Consensus.Processing.ProcessingStats\|[0-9]+\| *Block.+ETH"
g68='elapsed_ms:'
g69='DEBU?G +Session established'

# source /home/eth/eth2/a3
# slots = secounds 12,24,36,48,60,72,84,96,108,120,132,144,156,168,180,192,204,216,228,240,252,264,276,288,300
n00=300
n01=180
n02=240
n03=120
n04=3
n05=120
n06=12
n07=99
n08=22238623
n09=1606824023
n10=4500
n11=500
n12=15
n13=42
n14=8640  # 4*30*72
n15=100000
n16=80
n17=200
n18=20
n19=60
n20=500
n21=2
n22=200
n23=20000
n24=9999
n25=50
n26=90
n27=19000
n28=10000
n29=18800
n30=4000;[[ $n30 -eq 0 ]] && n30=$(curl -sX GET "$s50" 2>$p03|snf "$e70")
n31=$($s01 $s12 2>$p03|snf "$e71")
n32=4
n33=30
n34=10
n35=20048
n36=32765
n37=32768
n38=875
n39=111
n40=2049
n41=32400 # Main Plex Media Server port.
n42=32469 # Plex DLNA Server.
n43=3005  # Plex Companion.
n44=8324  # Plex for Roku.
n45=32410 # GDM network discovery.
n46=32411
n47=32412
n48=32413
n49=32414
n50=5353  # Bonjour/Avahi network discovery.
n51=445   # SMB
n52=137   # NetBIOS Name Service
n53=138   # NetBIOS Datagram Service
n54=139   # SMB traffic over NetBIOS
n55=8096  # Jellyfin Software Media System
n56=45    # Gas Block Limit - Max gas allowed in a block current default 36
n57=9     # max number of zero peers in order to trigger EL block/CL delete log
n58=1

s00='systemctl'
s01="$s00 status"
s02="$s00 stop"
s03="$s00 start"
s04="$s00 enable"
s05="$s00 disable"
s06="$s00 restart"
s07='timedatectl'
s08='networkctl'
s09='resolvectl'
s10='eth-geth'
s11='eth-besu'
s12='eth-beacon'
s13='eth-validator'
s14='eth-mev-boost'
s15='transmission-daemon'
s16='prometheus'
s17='prometheus-node-exporter'
s18='grafana-server'
s19='systemd-timesyncd'
s20='named'
s21='plexmediaserver'
s22='nginx'
s23="JAVA_HOME='/usr/lib/jvm/java-11-openjdk-amd64'"
s24=""
s24="$s24\n1 set $(basename $p19)\t\t\t\t\t[$nxvc]"
s24="$s24\n2 t6 tvc (vrs PR $n00;vd;scp slash_DB $nxvc:~)\t[$cuvc]"
s24="$s24\n3 t3 (keys,slash,srv)\t\t\t\t\t[$nxvc]"
s24="$s24\n4 check slash,srv,dirs\t\t\t\t\t[$nxvc]"
s24="$s24\n5 rm vc_lock;cuvc=$nxvc\t\t\t\t[$nxvc]"
s24="$s24\n6 t6 vea\t\t\t\t\t\t[$nxvc]"
s24="$s24\n7 rm -rf $p17\t\t\t[$cuvc]"
s24="$s24\n8 rm -f $p04/$s13.service\t[$cuvc]\n"
s25='0x27C7f54e48956A906aF2CBFBC8684b437776403d'
s26='0x534029B6371dc4453DD750Bc1198181F55C859fe'
s27="--connection=http://$(sni $cun2):5052 --allow-insecure-connections"
s28='Content-Type: application/json'
s29='offline-preparation'
case $cunm in $cun2) s34=$(sni $cun2);;$vnm1) s34=$vis1;;*) s34=$(sni $cun1);;esac
s30="http://$s34:8545"
s31="http://$s34:5052/eth/v1/node"
s32="http://$s34:5052/eth/v1/validator/duties"
s33="http://$s34:5052/lighthouse"
s34='.data[].slot'
s35='.data[].validator_index'
s36='Package: snapd'
s36="$s36\nPin: release a=*"
s36="$s36\nPin-Priority: -10"
s37='snap remove --purge'
s38="\n$p01\n{\n\trotate 7\n\tdaily\n\tmissingok\n\tnotifempty\n\tnocompress\n\tsharedscripts\n\tpostrotate\n\t\t/usr/lib/rsyslog/rsyslog-rotate\n\tendscript\n}"
s39='printf "Welcome to %s %s\\n" "$(hostname)" "$DISTRIB_DESCRIPTION"'
s40=''
s40="$s40\n\tauth-nxdomain no;"
if [[ $cunm = $znm1 || $cunm = $znm2 ]];then
  if [[ $cunm = $znm1 ]];then
    s40="$s40\n\tlisten-on { localhost; $zip1; };"
  else
    s40="$s40\n\tlisten-on { localhost; $zip2; };"
  fi
else
  s40="$s40\n\tlisten-on { any; };"
fi
s40="$s40\n\tlisten-on-v6 { none; };"
s40="$s40\n\tversion \"not currently available\";"
s40="$s40\n\trecursion yes;"
s40="$s40\n\tallow-recursion { localhost; 192.168.8.0/24; };"
s40="$s40\n\tallow-query { localhost; 192.168.8.0/24; };"
if [[ $cunm = $znm1 || $cunm = $znm2 ]];then
  if [[ $cunm = $znm1 ]];then
    s40="$s40\n\tallow-transfer { $zip2; };"
    s40="$s40\n\talso-notify { $zip2; };"
    s40="$s40\n\tmax-cache-size 70%;"
  else
    s40="$s40\n\tallow-transfer { $zip1; };"
    s40="$s40\n\talso-notify { $zip1; };"
    s40="$s40\n\tmax-cache-size 50%;"
  fi
else
  s40="$s40\n\tallow-transfer { none; };"
  s40="$s40\n\tmax-cache-size 10%;"
fi
s40="$s40\n\tquerylog yes;"
s40="$s40\n};"
s41=''
s41="$s41\nnetwork:"
s41="$s41\n  ethernets:"
for m in $(ip -j link|jq -r '.[]|select(.operstate=="UP").ifname');do
  s41="$s41\n    $m:"
  s41="$s41\n      dhcp4: true"
  s41="$s41\n      dhcp6: true"
  s41="$s41\n      critical: true"
done
for m in $(ip -j link|jq -r '.[]|select(.operstate=="DOWN").ifname');do
  s41="$s41\n    $m:"
  s41="$s41\n      dhcp4: true"
  s41="$s41\n      activation-mode: off"
done
s42="upstream plex_backend { server $zip2:32400; keepalive 32; }"
s42="$s42\nserver {"
s42="$s42\nlisten 80;"
s42="$s42\nserver_name $znm2;"
s42="$s42\nsend_timeout 100m;"
s42="$s42\nresolver 192.168.8.4 valid=300s;"
s42="$s42\nresolver_timeout 10s;"
s42="$s42\ngzip on;"
s42="$s42\ngzip_vary on;"
s42="$s42\ngzip_min_length 1000;"
s42="$s42\ngzip_proxied any;"
s42="$s42\ngzip_types text/plain text/css text/xml application/xml text/javascript application/x-javascript image/svg+xml;"
s42="$s42\ngzip_disable \"MSIE [1-6]\.\";"
s42="$s42\nclient_max_body_size 100M;"
s42="$s42\nproxy_set_header Host \$host;"
s42="$s42\nproxy_set_header X-Real-IP \$remote_addr;"
s42="$s42\nproxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;"
s42="$s42\nproxy_set_header X-Forwarded-Proto \$scheme;"
s42="$s42\nproxy_set_header Sec-WebSocket-Extensions \$http_sec_websocket_extensions;"
s42="$s42\nproxy_set_header Sec-WebSocket-Key \$http_sec_websocket_key;"
s42="$s42\nproxy_set_header Sec-WebSocket-Version \$http_sec_websocket_version;"
s42="$s42\nproxy_http_version 1.1;"
s42="$s42\nproxy_set_header Upgrade \$http_upgrade;"
s42="$s42\nproxy_set_header Connection \"Upgrade\";"
s42="$s42\nproxy_redirect off;"
s42="$s42\nproxy_buffering off;"
s42="$s42\nlocation / { proxy_pass http://plex_backend; }"
s42="$s42\n}"
s44="\n  IdentityFile ~/.ssh/id_ed25519"
s43='23:58'
s44='eth-nethermind'
s45='timesync'
s46='change-operations'
s47='https://boost-relay.flashbots.net/relay/v1/data/validator_registration?pubkey'
s48='.[].peer_info|select(.connection_direction=='
s49=').client.agent_string'
s50='https://pro-api.coinmarketcap.com/v1/cryptocurrency/quotes/latest?symbol=ETH&convert=EUR&CMC_PRO_API_KEY=3ae5f3df-bd71-489d-a9dd-b626995fba31'
s51='debian-transmission'
if [[ $cunm = $vnm1 ]];then
  s52='pool 0.ca.pool.ntp.org iburst maxsources 4'
  s52="${s52}\npool 1.ca.pool.ntp.org iburst maxsources 4"
 else
  s52='pool 0.europe.pool.ntp.org iburst maxsources 4'
  s52="${s52}\npool 1.europe.pool.ntp.org iburst maxsources 4"
fi
s53='sgms:'
s54='threshold|read|write|written|namespace|temperature|thermal|power|shutdowns|controller|endurance'
s55='net_peerCount'
s56='chrony'
s57="server $znm1.home.arpa iburst minpoll 3 maxpoll 6"
s57="${s57}\nserver $znm2.home.arpa iburst minpoll 3 maxpoll 6"
s58='nfs-kernel-server'
if [[ -d $p60 ]];then s59="$p60 192.168.8.0/24(rw,sync,no_subtree_check)";else s59="$p80 192.168.8.0/24(rw,sync,no_subtree_check)";fi
s60='plex'
s61='[nfsd]'
s61="${s61}\nmountd-port=$n35"
s61="${s61}\nstatd-port=$n36"
s61="${s61}\nlockd-port=$n37"
s61="${s61}\nrquotad-port=$n38"
s62='smbd'
s63='nmbd'
s64='jellyfin'
s65='https://repo.jellyfin.org/ubuntu'
s66='[mp4]'
if [[ -d $p60 ]];then s66="${s66}\npath=$p60\nforce user=$s60";else s66="${s66}\npath=$p80\nforce user=$s60";fi
s66="${s66}\nbrowsable=yes"
s66="${s66}\nread only=no"
s66="${s66}\nwritable=yes"
s66="${s66}\nguest ok=yes"
s67='--connect-timeout 1 --max-time 20'
s68="--connection=http://$(sni $cun1):8545 --consensus-connection=http://$(sni $cun1):5052 --allow-insecure-connections"
s69="m/44'/60'/0'/0"
s70='0x07128c0CCf171EBACFBDc9aaA324606579b79aD5'
s71='allow out to 192.168.8.0/24'
s72='GETH'
s73='BESU'
s74='NETH'
s75='BEAC'
s76='VALI'
s77='MEVB'
s78='.[].peer_info.seen_multiaddrs.[]'

e01='PollIntervalMinSec'
e02='PollIntervalMaxSec'
e14="s%^ *#* *$e01 *=.*$%$e01=12%i;s%^ *#* *$e02 *=.*$%$e02=32%i"
e00="s%^ *#* *NTP *=.*$%NTP=$zip1 $zip2 time.google.com time.cloudflare.com time.facebook.com%i";if [[ $cunm = $cuvc || $cunm = $cun1 || $cunm = $cun2 || $cunm = $cumv ]];then e00="$e00;$e14";fi
e01='s%^ *ENABLED=.*$%ENABLED=0%i'
e02='s%bind[^"]*"%bind -4"%'
e04='false';[[ ${cunm:4:5} = zotac ]] && e04='true' # intel NUCs erradamente give battery power to unattended upgrades
e03="s%^ */*(.*codename}-updates.*$)%\1%i;s%^ */* *Unattended-Upgrade::Mail .*$%Unattended-Upgrade::Mail \"hernanilr@gmail.com\";%i;s%^ */* *Unattended-Upgrade::OnlyOnACPower.*$%Unattended-Upgrade::OnlyOnACPower \"$e04\";%i;/Unattended-Upgrade::Package-Blacklist/i\Unattended-Upgrade::Services-Blacklist { \"$s10.service\"; \"$s11.service\"; \"$s44.service\"; \"$s12.service\"; \"$s13.service\"; \"$s14.service\"; };"
e04='s%^ *printf%# printf%i'
e05='s%^[^ ]+: +([^ ]+).*$%\1%p'
e06='/if.*grub_platform += +efi.*/,/EOF/{s%set +timeout *=.*%set timeout=0%;s%set +timeout_style *=.*%set timeout_style=hidden%}'
e07='/dnssec-validation/q'
e08='s%\t{3}:%\t%'
e09='s%.*registerValidator +[0-9]+ +([^ ]+) *$%\1%p'
e10="s%--execution-endpoint  *([^ ]*)[0-9\.]*:8551[^ ]*%--execution-endpoint \1$iip5:8551%"
e11="s%--execution-endpoint  *([^ ]*)[0-9\.]*:8551[^ ]*%--execution-endpoint \1$iip6:8551%"
e12="s%.*--execution-endpoint  *[^ ]*/([0-9\.]*):8551.*%\1%p"
e13="s%^ *#*NTP=.*$%NTP=time.google.com time.cloudflare.com time.facebook.com%i;$e14"
e14='s%--subscribe-all-subnets --import-all-attestations %%'
e15='s%--validator-monitor-file%--subscribe-all-subnets --import-all-attestations --validator-monitor-file%'
e16='s%--beacon-nodes *([^ ]*:5052),([^ ]*:5052)[^ ]*%--beacon-nodes \2,\1%'
e17='s%[^: ]*: *%%g;s%inactive%off%;s%active%on%'
e18='s%.*fee_recipient"."([^"]*)".*pubkey":"([^"]*)".*%pubkey: \2, fee: \1%p'
e19="s%^$g58 +[^ ]+([a-z1-9]{4}) +([^ ]{4}).*UFW BLOCK]%\4: \2\3 \U\5 ufw%"
e19="$e19;s% MAC=[^ ]*%%"
e19="$e19;s% IN=[^ ]*%%"
e19="$e19;s% OUT=[^ ]*%%"
e20='s%.*(Temperature|Sensor|Package|Core|Composite|temp[0-9]).*: *([-+][0-9][0-9]*\.[0-9]*).*%\2%p'
e21='s%.* ([0-9]*:[0-9]*):[0-9]*.*%\1%'
e22='s%.*pubkey": "([^"]*)".*%0x\1\n%p'
e23='/^ *\/swap/s%^%#%;/ext4 +defaults +/s%defaults%defaults,noatime%'
e24="s%download-dir\":[^,]+,%download-dir\": \"$p59\",%"
e24="$e24;s%incomplete-dir\":[^,]+,%incomplete-dir\": \"$p59\",%"
e24="$e24;s%rpc-authentication-required\":[^,]+,%rpc-authentication-required\": false,%"
e24="$e24;s%rpc-bind-address\":[^,]+,%rpc-bind-address\": \"$(sni $cunm)\",%"
e24="$e24;s%rpc-enabled\":[^,]+,%rpc-enabled\": true,%"
e24="$e24;s%rpc-host-whitelist-enabled\":[^,]+,%rpc-host-whitelist-enabled\": false,%"
e24="$e24;s%rpc-socket-mode\":[^,]+,%rpc-socket-mode\": \"0755\",%"
e24="$e24;s%rpc-whitelist\":[^,]+,%rpc-whitelist\": \"127.0.0.1,192.168.8.*\",%"
e24="$e24;s%rpc-username\":[^,]+,%rpc-username\": \"\",%"
e24="$e24;s%rpc-password\":[^,]+,%rpc-password\": \"\",%"
e25='s%Type=.*$%Type=simple%'
e26='s%(Current DNS)[^:]+:%   \1:%ip'
e28='pcie_aspm=off';[[ $cunm = teste$inm5 ]] && e28="$e28 pci=noaer" # Disabling AER (Advanced Error Reporting) logging
e27="s%GRUB_CMDLINE_LINUX_DEFAULT *= *\"(.+)\"%GRUB_CMDLINE_LINUX_DEFAULT=\"\1 $e28\"%;s%GRUB_CMDLINE_LINUX_DEFAULT *= *\"\"%GRUB_CMDLINE_LINUX_DEFAULT=\"$e28\"%"
e28="s%APT::Periodic::Update-Package-Lists.*$%APT::Periodic::Update-Package-Lists \"1\";%i"
e28="${e28};s%APT::Periodic::Unattended-Upgrade.*$%APT::Periodic::Unattended-Upgrade \""
case $cunm in $cuvc) e28="${e28}3";;$inm6) e28="${e28}2";;*) e28="${e28}1";;esac
e28="${e28}\";%i;/APT::Periodic::Unattended-Upgrade/a \\"
e28="${e28}APT::Periodic::AutocleanInterval \"1\";"
if [[ $cunm = $cuvc && $cunm = $cun1 && $cunm = $cun2 ]];then e30='e';e31='c';else case $cunm in $cun1) e30='e';e31='b';;$cun2) e30='e';e31='b';;$cuvc) e30='e';e31='v';;*) e30='e';e31='c';;esac;fi;if sht;then e32='hrv-(zotac|intel)[0-9]';else e32='ns([0-9]+)';fi
e34='([A-Z]{1,4})[A-Z]*'                                                                               # log tag show first 4 chars only
e33="$e32 +nethermind$g05 +$g01$g00$g03 +"
e35="$e32 +lighthouse$g05 +$g00$g01$g03($g04)[0-9]* +$e34 +"
e29="s%^$g58 +$e35%$e31\5: \2\3 \8\t%"                                                                 # syslog lighthouse
e29="$e29;s%^$g58 +$e33\| +%$e30\5: \2\3\t%"                                                           # syslog nethermind
e29="$e29;s%^$g23($g03$g04)[0-9]*\|$e34\|.+\|[0-9]{,5}\|%${e30}int: \1 \2 %"                           # internal nethermind logs
e29="$e29;s%^$g58 +$e32 +mev-boost$g05 +time=\"[^\"]+\"%m\5: \2\3%"
e30="s%.+$e32 +(.*)%\2%;s% +% %g"
e31="s%.*$g03$g04[0-9]* *(.*)%\1%;s%\t\t*% %g;s% +% %g;s%[\"\/]%%g"
e32="s%(https?://)?127\.0\.0\.1(:[0-9]+)/?%lh\2%g"
e32="$e32;s%(https?://)?192\.168\.8\.([0-9]+:[0-9]+)/?%\2%g"
e33='s%<html>.{10,}</html>%%g'
e34='s% *\([^)(]{10,}\)%%g'
e35='s% *\{[^}{]{10,}\}%%g'
e36='s% *0x[A-Za-z0-9]{10,}%%g'
e37="$e34;$e35;$e36"                                                                                   # FINAL
e38='s%(hash|root) *= *([^ ,]*),? *%%g'                                                                # EL
e38="$e38;s%[0-9]+ +[0-9]+ +[0-9]+ +%%g;s%[0-9]+ +[0-9]+ +%%g"                                         # EL
e39='s%(finalized_root|block|head|parent_hash|pubkey|block_hash|peer_id|graffiti) *: *([^, ]*),? *%%g' # CL
e40='s%(Some|Slot) *\(([^ ]*)\)%\2%g;s%,? *(module) *: *([^ ,]*),? *%%g'                               # CL
e40="$e40;s%builder_boost_factor: +None,?%%"                                                           # CL
e40="$e40;s%_value: *([0-9]{18}) *,%: ðŸ’° 0.\1,%g"                                                      # CL
e40="$e40;s%_value: *([0-9]{17}) *,%: ðŸ’° 0.0\1,%g"                                                     # CL
e40="$e40;s%_value: *([0-9]{16}) *,%: ðŸ’° 0.00\1,%g"                                                    # CL
e40="$e40;s%_value: *([0-9]{15}) *,%: ðŸ’° 0.000\1,%g"                                                   # CL
e40="$e40;s%_value: *([0-9]{14}) *,%: ðŸ’° 0.0000\1,%g"                                                  # CL
e40="$e40;s%block_slot:%bl:%g"                                                                         # CL
e41="s%snapdiffs *= *%sdf=%g;s%triediffs *= *%tdf=%g;s%triedirty *= *%tdt=%g;$e38"                     # ALL EL
e42="$e41;s%(service|num_failed) *: *([^ ,]*),? *%\2 %g;$e39;$e40"                                     # ALL EL/CL
e43='s%(level) *= *([a-z]{4})[a-z]* +%\U\2\t%;s%msg *= *\"([^"]+)\",?%\1%'                             # RL
e44='s%(blockHash|parentHash|pubkey|txRoot|slotUID|ua) *= *[^ ,]+ *%%g'                                # RL
e44="$e44;s%(method|numRegistrations) *= *([^ ,]+),? *%\2 %g"                                          # RL
e45='s%https?://([a-z0-9\.\-]+)(//*[a-z0-9_]+)* *%\1%g;s%url *= *\"([^\"]+)\"%\1%'                     # RL
e46='s%Get +..[^:]+..: +%GET %;s%Post +..[^:]+..: +%POST %;s%path *= *(//*[a-z0-9_]+)+ *%%'            # RL
e47="$e29;$e32;$e33;$e42;$e43;$e44;$e45;$e46"                                                          # ALL EL/CL/RL
e48='s% *((Server|Offset|Delay|Jitter)[^)(]*)\(?.*\)?%\1%ip'
e49="s%$g52%\1 \2 \3 \4%p"
e50="$e29;$e32;$e42"
e50="$e50;s%validation_error: *,?%%g"
e50="$e50;s%latest_valid_hash: *,?%%g"
e50="$e50;s%execution_block_hash: *,?%%g"
e50="$e50;s%block_root:%br%g"
e50="$e50;s%epoch:%ep%g"
e50="$e50;s%slot:%sl%g"
e50="$e50;s%proposer_index:%pi%g"
e50="$e50;s%set_as_head_time_ms:%sht%g"
e50="$e50;s%consensus_time_ms:%cst%g"
e50="$e50;s%blob_delay_ms:%blb%g"
e50="$e50;s%available_delay_ms:%avl%g"
e50="$e50;s%total_delay_ms:%tot%g"
e50="$e50;s%observed_delay_ms:%obs%g"
e50="$e50;s%$g54%ID%g"
e50="$e50;s%$g55%ED%g"
e50="$e50;s%$g56%AD%g"
e50="$e50;$e37;s%\"%%g"
e51="$e47;$e37;s% *(slotTimeSec|genesisTime)=[0-9]+%%ig;s%[^ ]+EthConsensusVersion=[^ ]+%%ig;s%[^ ]+ContentTypes?=[^ ]+%%ig"
e52="$e51;s%blockNumber=[0-9]+ +getHeader +%%i;s%slot=[0-9]+ +%%i;s%relays=%%i;s%best +bid +%%i;s% +value=([0-9]*\.?[0-9]+)%\t\tðŸ’° \1%"
e53="s%^ *$p01%# $p01%"
e54='s%.*synchronized: *([a-z]*) *%\1%p'
e55="s%$g03%%;s%[0-9]* users*,%%;s% average([^,]*).*%\1%;s%  *% %g"
e56='s%.*result" *: *"0x([^"]+)".*%\1%ip'
e57='s%^ +Active: +(.*) *$%\1%p'
e58='[^ ]+([^ ]{26,})( +[0-9]+ +[0-9])%\1';e59="s%^(.. )${e58}<\2\3%i"
e58='[^ ]+([^ ]{25,})( +[0-9]+ +[0-9])%\1';e60="s%^${e58}\2%i"
e58='s% +since +[^;]+;%%'
e61='s%.*highestBlock: *([0-9]+).*%\1%ip'
e62='s%.*currentBlock: *([0-9]+).*%\1%ip'
e63='s%.*highestBlock" *: *"0x([^"]+)".*%\1%ip'
e64='s%.*currentBlock" *: *"0x([^"]+)".*%\1%ip'
e65='s%([Pp]eers[ =]*)[0-9]+%\1'
e66='s%^[^,]+(https?)%\1%;s%@([^@ ]+) +.*$%@\1%;s%https?[^@]+@%%g;s%,% %gp'
e67='s%^([^,]+,){6}([^,]+),.*$%\2%p'
e68='s%^.,\*,([^,]+),([^,]+),([^,]+,){3}([^,]+),[^,]+,([^,]+).*$%\1 \2 \4 \5%p'
e69="s%^ *#* *PasswordAuthentication  *.*$%PasswordAuthentication no%i"
e70='s%.*price": *([0-9]*\.?[0-9]+).*%\1%p'
e71='s%.*PID: *([0-9]+).*%\1%p'
e72='s%^ *pool  *%# pool %'
e73='s%^.*mev-boost +(v[0-9]+\.[0-9]+)(\.[0-9]+)?.*$%\1\2%'
e75="s%^$g58 +[^ ]+([a-z1-9]{4}) +([^ ]{4})[^ ]+ +"
e74="$e75%\U\5 %"
e75="$e75%\4: \2\3 \U\5\t%"
e78='"?([0-9]{1,})"?.*$'
e76="$e29;s%$g30: *$e78%peers \1%i"
e77="$e29;s%(\.[0-9]{1,}) *.*$g35 *$e78%\1 peers \2%i"
e78="$e29;s%(\.[0-9]{1,} INFO) *.*$g31: *$e78%\1 peers \2%i"
e79='s%disable-upnp%disable-upnp --checkpoint-sync-url';if [[ $cunm = $inm5 ]];then e79="$e79 http://$iip6:5052%";elif [[ $cunm = $inm6 ]];then e79="$e79 http://$iip5:5052%";else e79="$e79 https://mainnet.checkpoint.sigp.io%";fi
e80='s%^ *VERSION_CODENAME *= *%%p'
e81='/^ *\$nrconf\{override_rc\}/a \    qr(^eth-.+\\.service$) => 0, # do not restart ethereum services'
e82='s%^([a-z]+[0-9]+)[ :]+active +(raid[01564]).+$%\1 \2%p'
e83='s%^.*version +([0-9]+\.[0-9]+\.[0-9]+).*$%v\1%p'
e84='([0-9]+\.[0-9]+) *ETH.*%\1%p'

j0='.ata_sct_temperature_history.table|join(" ")'
j1='.temperature.current'
j3='.nvme_smart_health_information_log.temperature_sensors|join(" ")'
j4='.nvme_smart_health_information_log|"\(.critical_warning) \(.media_errors) \(.num_err_log_entries) \(.percentage_used) \(.available_spare)"'
j5='.nvme_smart_health_information_log|"\(.critical_warning)+\(.media_errors)"'
j6='.Devices[]|[.DevicePath,.UsedBytes,.ModelNumber,.Firmware,.SerialNumber]|@tsv'

w0='{if(match($0,/'
w1='([0-9,]+(\.[0-9]+)?) *'
w2='([0-9,]+(\.[0-9]+)?) *(ns|us|Âµs|ms|s)/,m)){if(m[3]=="s"){m[1]*=1000};if(m[3]=="us"){m[1]/=1000};if(m[3]=="Âµs"){m[1]/=1000};if(m[3]=="ns"){m[1]/=1000000};printf("%.3f\n",m[1])}}'
w3='([0-9,]+(\.[0-9]+)?) *(ns|us|Âµs|ms|s)/,m)){if(m[3]=="s"){m[1]*=1000000};if(m[3]=="ms"){m[1]*=1000};if(m[3]=="ns"){m[1]/=1000};printf("%.0f\n",m[1])}}'
w4='(ns|us|Âµs|ms|s)/,m)){if(m[3]=="s"){m[1]*=1000};if(m[3]=="us"){m[1]/=1000};if(m[3]=="Âµs"){m[1]/=1000};if(m[3]=="ns"){m[1]/=1000000};gsub(/,/,"",m[1]);printf("%.3f\n",m[1])}}'

unset b
# b[ 11766]='0x93bf23a587f11f9eca329a12ef51296b8a9848af8c0fe61201524b14cb85b0c6fbd3e427501cdfa3b28719bd1ed96fff'
# b[ 11767]='0xb5b0fc3d2ba577f3e2c7324f7ea4306f17eeee0f12c722f4fa83e45bf6c15477d50261bb2666c30f21ab71a26aeeeafb'
# b[ 11770]='0x89e65476ab56bd1e102569531453620ef805adc4dea9caaa671a9b78a9e7ab61e713d038599364c9321ccc7b50f6bafd'
# b[ 11771]='0xad37967c868bcbb69d73dcc82717bf5df57048703277ee48aaf64e753c71631bc17c46934da40fb5f8344390f9880c1a'
# b[ 11772]='0xaf5e6791b3cbd587268b8da1822f9b0398cbd796eb4e9af856f561217981d9f9469d7f06accd9ae9ebe1b87d338330b4'
# b[ 11773]='0x8606838b0ba9fcdcc2a61925305210cd3e44fe673d99bbb6f180242afa965f513bf7b8c298806171a05a12b6b3d5dd24'
# b[ 11774]='0x880c275f193c45276bd250f25092305e06f12d725ecf9761b29051c1fd9a43c8c15c31012316ebad8459c4268824cb34'
# b[ 11775]='0x8d7dcdd66f978549965d6ee6828adeaaf6ebb98e8dcb505d003e5369bc3513f090027e77faa0ae0246b6f08344872a73'
# b[ 11776]='0x867cf5fd6d05017ef9df4d6ff157e2a8e97bbeb1522de427e82092e485fe7f305b651767997b2a21b6c91d83218493a1'
# b[ 11777]='0xa2873632721623389d9bc5f455cb21e92244044cebd3bff6d5a809f78edde3de22c67ffc97a672c7ab573f7787c2c8bd'
# b[ 11778]='0x8235d97c3530b6261eec3c658dd158ae5ed98481ead16a33837a083924028393634a71515affa76dcd371b943ee733ab'
# b[ 11779]='0x88c2befbce7594c943a386573f03b8ce461457bf59267ffce3e6008b115d70259583ad5fe8d8b15487d84734a6ba8d17'
# b[ 11780]='0x814fa0dbba56e8823bd00935e5c67b09c468d5734e80e6574c5984e736300431761bf083ef247f75a73eb1b4c01bde9b'
# b[ 11782]='0xae1212d040fabbbd3e6947ecf4799ee5176a1d42e2848d8ebee030690aa4144143c30d32c52fb3931927355470c8f416'
# b[ 11783]='0xad71900411ae03e4c63f23d7823ac3754e2ec0b8855693e15632536de677aca9f45ffeaf080ce234cbf3967723f79d45'
# b[ 11784]='0xa96278aff172bdebb92e6312eb3b46b0b6ec58e5a9cad46f7958b8d795a97edfb425bc4f2cc5cf92b5a3355577ad6af5'
# b[ 11786]='0xb2063ebff899e91b70de66115a2a0e590b8695930126f9d7cad090ca7f19d47b262c7c21dd9208ff6d4c8eea307b4ad3'
# b[ 11788]='0x87615568c977431c53171ba39b1f559515e6273b5efe8b649eab88ba6a5abc7e2280bea2f61898b53079a1f1bd3f5caa'
# b[449113]='0x968b8658458dfd6db14e10a7c0623573113e70c890d53db598f622f5a57300f1c1bd8cd1d27a7a5d882841f179928416'
# b[449114]='0xa137c606f3f700789f2ef09bf71962b8023bee33d1b1db367a6dbb9bb3ad3d03c32247b2fec84afb57029b5de8169e7b'
# b[449115]='0xb9c82583ba13992858faab8f813f9d1b4e50cbe5f2319b00fff781ff9e6cf5ff3e746f146f191d095cc72553597ecd2d'
# b[449116]='0xae08e5f26f503c36ac554c5fbca45495405866ebfaa8976c3791e8461dee8ec34ce3e99e65c76db2bf7408a60d717299'
# b[590905]='0xa8b644d7ea657f9abef0256155a08aac46f16a7ea083e53916c004702ffc8e93aed2d28114fe924653a0c2e570d82cf8'
# b[590906]='0xa15449ffda354fc6f9de4bd6f020b419bf23e4256d6396213e81c302f7814a259931bd8f4c8e1e285a0f5222c5a1fa80'
# b[590907]='0x82b93acde57a8c5ef6da79e79a8aca4438e035ec890f1bd7db7c356de4926841ab649e3d25c67e7714c976bc49e5a034'
# b[1027307]='0x83c7c2d579df3b6f00513730e1bd2acb8c1515ecd0d158535d9e6c37dadbfbff20d9abd442527fdce970c3dd2818e710'
b[1922417]='0xb41924d002745858fbbd7a728a8baf2f9d5ab9a49409809d0fb37319ba9d464fe9e5235c357a240a8eceef3fda442e1f'

# source /home/eth/eth2/a4
